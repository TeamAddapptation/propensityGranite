<script>
	/* ------------------------------------------------------------
Global Variable for holding selected Values
-------------------------------------------------------------- */
	let selectedRowsArr = [];
	/* ------------------------------------------------------------
Record Object
-------------------------------------------------------------- */
	const headerKeys = {
		value: "",
		selectRow: true,
		custom_function: selectHeaderHandler("email"), // data attribute value that will be appended to the global array named 'selectedRowsArr'
		classes: "all",
	};
	const recordKeys = {
		value: "",
		selectRow: true,
		custom_function: selectRowHandler(r, "email", "work_email"),
		// - r: The record object containing all the data.
		// - "email": The identifier for the data attribute (e.g., data-email).
		// - "work_email": The value to be assigned to the data attribute (e.g., data-email="r.work_email").
	};
	/* ------------------------------------------------------------
Row Selection
-------------------------------------------------------------- */
	function selectHeaderHandler(attrKey) {
		const selectContainer = document.createElement("div");
		selectContainer.id = "g__select-header";
		selectContainer.classList.add("g__select-column", "g__select-record");
		selectContainer.innerHTML = `<i class="fa fa-check" aria-hidden="true"></i>`;
		selectContainer.addEventListener("click", (e) => {
			selectContainer.classList.toggle("g__rows-all-selected");
			const selectorArr = document.querySelectorAll(".g__select-row");
			const rowArr = document.querySelectorAll(".g__table-row");
			if (selectContainer.classList.contains("g__rows-selected")) {
				selectContainer.classList.toggle("g__rows-all-selected");
				rowArr.forEach((row) => {
					row.classList.remove("g__row-selected");
					row.querySelector(".g__select-row").classList.remove("g__select-active");
				});
				selectedRowsArr = [];
			} else {
				selectorArr.forEach((sel) => {
					sel.classList.remove("g__select-active");
					if (selectContainer.classList.contains("g__rows-all-selected")) {
						sel.classList.add("g__select-active");
						const selectValue = sel.dataset[attrKey];
						selectedRowsArr.push(selectValue);
					} else {
						sel.classList.remove("g__select-active");
						selectedRowsArr = [];
					}
				});
			}
			selectContainer.classList.remove("g__rows-selected");
			console.log(selectedRowsArr);
		});
		return selectContainer;
	}

	function selectRowHandler(r, attrKey, attrValue) {
		const selectContainer = document.createElement("div");
		selectContainer.classList.add("g__select-row", "g__select-record");
		selectContainer.innerHTML = `<i class="fa fa-check" aria-hidden="true"></i>`;
		selectContainer.setAttribute(`data-${attrKey}`, r[attrValue]);
		selectContainer.addEventListener("click", (e) => {
			const headerCell = document.getElementById("g__select-header");
			selectContainer.classList.toggle("g__select-active");
			e.target.closest("tr").classList.toggle("g__row-selected");
			const selectValue = selectContainer.dataset[attrKey];
			//Build Array with Values and push to hidden field
			if (selectedRowsArr.includes(selectValue)) {
				const position = selectedRowsArr.indexOf(selectValue);
				selectedRowsArr.splice(position, 1);
			} else {
				selectedRowsArr.push(selectValue);
			}
			//Apply proper class to header
			headerCell.classList.remove("g__rows-all-selected", "g__rows-selected");
			if (selectedRowsArr.length == totalRecordsCount) {
				headerCell.classList.add("g__rows-all-selected");
			} else if (selectedRowsArr.length >= 1) {
				headerCell.classList.add("g__rows-selected");
			}
			console.log(selectedRowsArr);
		});

		return selectContainer;
	}
	/* ------------------------------------------------------------
NOTE - Add this line to the updateTable() function 
previously selected values do not carry over when using pagination
-------------------------------------------------------------- */
	if (selectedRowsArr.length) {
		selectedRowsArr = [];
	}
</script>
